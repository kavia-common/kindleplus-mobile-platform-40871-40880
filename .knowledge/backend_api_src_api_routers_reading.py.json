{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing reading progress in a reading application. It includes functions to list, retrieve, and upsert reading progress records for authenticated users, utilizing FastAPI, SQLAlchemy, and Pydantic. It also contains data models for request payloads and uses dependency injections for database sessions and user authentication.", "external_files": ["src/db/session.py", "src/models/book.py", "src/models/readings_progress.py", "src/models/user.py", "src/schemas/reading_progress.py", "src/services/auth_service.py", "src/utils/pagination.py"], "external_methods": ["get_db", "get_current_user", "PageMeta.build", "sanitize_pagination", "offset_limit"], "published": ["list_reading_progress", "get_progress_for_book", "upsert_progress_for_book"], "classes": [{"name": "ReadingProgressUpsertRequest", "description": "Data model for creating or updating reading progress, includes optional fields for progress percent, current chapter, location, and completion status."}], "methods": [{"name": "Select _query_user_progress_base(user_id: str)", "description": "Builds a base SQLAlchemy select statement for querying a user's reading progress with related book and user data preloaded.", "scope": "", "scopeKind": ""}, {"name": "Paginated[ReadingProgressRead] list_reading_progress( is_completed: Optional[bool] = Query( default=None, description=\"If provided, filter by completion status (true/false)\" ), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Endpoint to list the authenticated user's reading progress with optional filtering by completion status and pagination.", "scope": "", "scopeKind": ""}, {"name": "ReadingProgressRead get_progress_for_book( book_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Retrieves reading progress for a specific book for the authenticated user, raising a 404 error if not found.", "scope": "", "scopeKind": ""}, {"name": "ReadingProgressRead upsert_progress_for_book( book_id: str, payload: ReadingProgressUpsertRequest, response: Response, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Creates or updates a reading progress record for a specific book, setting provided fields, and returning the updated record.", "scope": "", "scopeKind": ""}], "calls": ["select", "selectinload", "func.count", "db.scalar", "db.execute", "db.get", "db.refresh", "ReadingProgressRead.model_validate", "ReadingProgress.model_dump"], "search-terms": ["reading progress", "upsert progress", "get progress book", "pagination", "user reading progress", "fastapi reading endpoints", "SQLAlchemy reading progress", "reading progress API"], "state": 2, "file_id": 43, "knowledge_revision": 101, "git_revision": "", "ctags": [{"_type": "tag", "name": "PydBaseModel", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^from pydantic import BaseModel as PydBaseModel$/", "language": "Python", "kind": "unknown", "nameref": "unknown:BaseModel"}, {"_type": "tag", "name": "ReadingProgressUpsertRequest", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^class ReadingProgressUpsertRequest(PydBaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_query_user_progress_base", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def _query_user_progress_base(user_id: str) -> Select:$/", "language": "Python", "typeref": "typename:Select", "kind": "function", "signature": "(user_id: str)"}, {"_type": "tag", "name": "get_progress_for_book", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def get_progress_for_book($/", "language": "Python", "typeref": "typename:ReadingProgressRead", "kind": "function", "signature": "( book_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "list_reading_progress", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def list_reading_progress($/", "language": "Python", "typeref": "typename:Paginated[ReadingProgressRead]", "kind": "function", "signature": "( is_completed: Optional[bool] = Query( default=None, description=\"If provided, filter by completion status (true/false)\" ), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^router = APIRouter(prefix=\"\\/reading\", tags=[\"Reading\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "upsert_progress_for_book", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def upsert_progress_for_book($/", "language": "Python", "typeref": "typename:ReadingProgressRead", "kind": "function", "signature": "( book_id: str, payload: ReadingProgressUpsertRequest, response: Response, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}], "hash": "d979f94f9aeafd5d24f1e74aad4ca11f", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/api/routers/reading.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/reading\", tags=[\"Reading\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"101": ""}]}