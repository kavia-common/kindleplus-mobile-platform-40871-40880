{"is_source_file": true, "format": "Python", "description": "This file defines API routes related to reading progress, including listing, retrieving, and updating reading progress records for books in a user-specific context, using FastAPI and SQLAlchemy.", "external_files": ["src/db/session.py", "src/models/book.py", "src/models/reading_progress.py", "src/models/user.py", "src/schemas/reading_progress.py", "src/services/auth_service.py", "src/utils/pagination.py"], "external_methods": ["get_db", "get_current_user", "PageMeta.build", "sanitize_pagination", "offset_limit"], "published": ["list_reading_progress", "get_progress_for_book", "upsert_progress_for_book"], "classes": [{"name": "ReadingProgressUpsertRequest", "description": "Pydantic model for creating or updating reading progress, includes optional progress percentage, current chapter, location, and completion status."}], "methods": [{"name": "Select _query_user_progress_base(user_id: str)", "description": "Builds a base SQLAlchemy select statement for fetching reading progress entries for a specific user, with related book and user data preloaded.", "scope": "", "scopeKind": ""}, {"name": "Paginated[ReadingProgressRead] list_reading_progress( is_completed: Optional[bool] = Query( default=None, description=\"If provided, filter by completion status (true/false)\" ), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Endpoint to list the current user's reading progress with optional filtering by completion status, paginated.", "scope": "", "scopeKind": ""}, {"name": "ReadingProgressRead get_progress_for_book( book_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Endpoint to retrieve reading progress for a specific book in the current user's library.", "scope": "", "scopeKind": ""}, {"name": "ReadingProgressRead upsert_progress_for_book( book_id: str, payload: ReadingProgressUpsertRequest, response: Response, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Endpoint to create or update the reading progress for a given book for the current user.", "scope": "", "scopeKind": ""}], "calls": ["select(ReadingProgress)", "selectinload(ReadingProgress.book)", "selectinload(ReadingProgress.user)", "func.count(ReadingProgress.id)", "offset_limit(page, page_size)", "sanitize_pagination(page, page_size)", "PageMeta.build"], "search-terms": ["ReadingProgress API", "reading progress endpoints", "FastAPI reading routes", "user reading progress", "progress upsert", "pagination", "book progress retrieval"], "state": 2, "file_id": 43, "knowledge_revision": 103, "git_revision": "5e046654ba1542ba7515b52443888823594448fb", "revision_history": [{"101": ""}, {"103": "5e046654ba1542ba7515b52443888823594448fb"}], "ctags": [{"_type": "tag", "name": "PydBaseModel", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^from pydantic import BaseModel as PydBaseModel$/", "language": "Python", "kind": "unknown", "nameref": "unknown:BaseModel"}, {"_type": "tag", "name": "ReadingProgressUpsertRequest", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^class ReadingProgressUpsertRequest(PydBaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_query_user_progress_base", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def _query_user_progress_base(user_id: str) -> Select:$/", "language": "Python", "typeref": "typename:Select", "kind": "function", "signature": "(user_id: str)"}, {"_type": "tag", "name": "get_progress_for_book", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def get_progress_for_book($/", "language": "Python", "typeref": "typename:ReadingProgressRead", "kind": "function", "signature": "( book_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "list_reading_progress", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def list_reading_progress($/", "language": "Python", "typeref": "typename:Paginated[ReadingProgressRead]", "kind": "function", "signature": "( is_completed: Optional[bool] = Query( default=None, description=\"If provided, filter by completion status (true/false)\" ), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^router = APIRouter(prefix=\"\\/reading\", tags=[\"Reading\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "upsert_progress_for_book", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/reading.py", "pattern": "/^def upsert_progress_for_book($/", "language": "Python", "typeref": "typename:ReadingProgressRead", "kind": "function", "signature": "( book_id: str, payload: ReadingProgressUpsertRequest, response: Response, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}], "hash": "0a11fceed9258ba9e868a7c864a92ba8", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/api/routers/reading.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/reading\", tags=[\"Reading\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}