{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for storage-related operations using FastAPI, including presigned URL generation for upload and download, and some stub endpoints for local storage handling.", "external_files": ["src.services.storage_service", "src.services.auth_service"], "external_methods": ["get_storage", "get_token_payload"], "published": ["presign_upload", "presign_download", "local_download", "local_upload"], "classes": [{"name": "PresignRequest", "description": "Data model for requests to generate presigned URLs, including object key and expiration time."}, {"name": "PresignUploadResponse", "description": "Data model for the response containing presigned upload URL and form fields."}, {"name": "PresignDownloadResponse", "description": "Data model for the response containing presigned download URL."}], "methods": [{"name": "_auth_required(authorization: Optional[str] = Header(None))", "description": "Dependency that enforces authentication by validating bearer token in the header.", "scope": "", "scopeKind": ""}, {"name": "presign_upload(req: PresignRequest, auth=Depends(_auth_required))", "description": "API endpoint to get a presigned URL for uploading, with validation on expiry.", "scope": "", "scopeKind": ""}, {"name": "presign_download(req: PresignRequest, auth=Depends(_auth_required))", "description": "API endpoint to get a presigned URL for downloading, with validation on expiry.", "scope": "", "scopeKind": ""}, {"name": "local_download(key: str, exp: int, sig: str)", "description": "Stub endpoint for local download, for demonstration or testing.", "scope": "", "scopeKind": ""}, {"name": "local_upload(key: str, exp: int, sig: str)", "description": "Stub endpoint for local upload, for demonstration or testing.", "scope": "", "scopeKind": ""}], "calls": ["get_storage()", "get_token_payload(token, expected_type=\"access\")", "storage.presign_upload(req.key, req.expires_in)", "storage.presign_download(req.key, req.expires_in)"], "search-terms": ["storage presign", "FastAPI storage endpoints", "presigned URL", "authentication dependency", "local storage stub"], "state": 2, "file_id": 46, "knowledge_revision": 172, "git_revision": "ba179e9cf3373dfe251d8ce58c3eddcd821be757", "revision_history": [{"116": ""}, {"135": "55299610ad3eceeba2da47c02fa820d21e779ef8"}, {"158": "55299610ad3eceeba2da47c02fa820d21e779ef8"}, {"172": "ba179e9cf3373dfe251d8ce58c3eddcd821be757"}], "ctags": [{"_type": "tag", "name": "PresignDownloadResponse", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^class PresignDownloadResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PresignRequest", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^class PresignRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PresignUploadResponse", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^class PresignUploadResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_auth_required", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^def _auth_required(authorization: Optional[str] = Header(None)):$/", "language": "Python", "kind": "function", "signature": "(authorization: Optional[str] = Header(None))"}, {"_type": "tag", "name": "expires_in", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^    expires_in: int = Field(600, description=\"Expiration in seconds (max 3600)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PresignRequest", "scopeKind": "class"}, {"_type": "tag", "name": "fields", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^    fields: dict = {}$/", "language": "Python", "typeref": "typename:dict", "kind": "variable", "scope": "PresignUploadResponse", "scopeKind": "class"}, {"_type": "tag", "name": "key", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^    key: str = Field(..., description=\"Object key\\/path in storage\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PresignRequest", "scopeKind": "class"}, {"_type": "tag", "name": "local_download", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^def local_download(key: str, exp: int, sig: str):$/", "language": "Python", "kind": "function", "signature": "(key: str, exp: int, sig: str)"}, {"_type": "tag", "name": "local_upload", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^def local_upload(key: str, exp: int, sig: str):$/", "language": "Python", "kind": "function", "signature": "(key: str, exp: int, sig: str)"}, {"_type": "tag", "name": "presign_download", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^def presign_download(req: PresignRequest, auth=Depends(_auth_required)):$/", "language": "Python", "kind": "function", "signature": "(req: PresignRequest, auth=Depends(_auth_required))"}, {"_type": "tag", "name": "presign_upload", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^def presign_upload(req: PresignRequest, auth=Depends(_auth_required)):$/", "language": "Python", "kind": "function", "signature": "(req: PresignRequest, auth=Depends(_auth_required))"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/storage.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}], "hash": "3d4a4f299081aed3572b67354eb3bc95", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/api/routers/storage.py", "fields": [{"name": "int expires_in", "scope": "PresignRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "dict fields", "scope": "PresignUploadResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str key", "scope": "PresignRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}]}