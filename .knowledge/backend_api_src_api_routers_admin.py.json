{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for administrative statistics and controls for a backend service, including sales reports, top books, and user/revenue summaries using FastAPI and SQLAlchemy.", "external_files": [".../db/session", ".../models/purchase", ".../models/book", ".../models/user", ".../services/auth_service"], "external_methods": ["verify_token"], "published": [], "classes": [], "methods": [{"name": "_get_db()", "description": "Creates a new database session and ensures it is closed after use.", "scope": "", "scopeKind": ""}, {"name": "_admin_required(authorization: Optional[str] = None, db: Session = Depends(_get_db))", "description": "Dependency that verifies admin privileges based on a Bearer token.", "scope": "", "scopeKind": ""}, {"name": "sales_by_day(days: int = Query(7, ge=1, le=90), admin=Depends(_admin_required), db: Session = Depends(_get_db))", "description": "API endpoint that retrieves daily sales counts and revenue for the past 'days' days.", "scope": "", "scopeKind": ""}, {"name": "top_books(limit: int = Query(5, ge=1, le=50), admin=Depends(_admin_required), db: Session = Depends(_get_db))", "description": "API endpoint that retrieves the top selling books limited by 'limit'.", "scope": "", "scopeKind": ""}, {"name": "summary(admin=Depends(_admin_required), db: Session = Depends(_get_db))", "description": "API endpoint that provides total revenue and user count summaries.", "scope": "", "scopeKind": ""}], "calls": ["verify_token", "db.query", "db.query(func.date(Purchase.created_at)", "db.query(func.count(Purchase.id))", "db.query(func.sum(Purchase.price_cents))", "db.query(Book.title, func.count(Purchase.id))", "db.query(func.coalesce(func.sum(Purchase.price_cents), 0))", "db.query(func.count(User.id))"], "search-terms": ["API routers", "admin statistics endpoints", "sales report", "top books", "admin authorization", "FastAPI dependencies"], "state": 2, "file_id": 48, "knowledge_revision": 133, "git_revision": "", "revision_history": [{"120": ""}, {"133": ""}], "ctags": [{"_type": "tag", "name": "_admin_required", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/admin.py", "pattern": "/^def _admin_required(authorization: Optional[str] = None, db: Session = Depends(_get_db)):$/", "language": "Python", "kind": "function", "signature": "(authorization: Optional[str] = None, db: Session = Depends(_get_db))"}, {"_type": "tag", "name": "_get_db", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/admin.py", "pattern": "/^def _get_db():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/admin.py", "pattern": "/^router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "sales_by_day", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/admin.py", "pattern": "/^def sales_by_day(days: int = Query(7, ge=1, le=90), admin=Depends(_admin_required), db: Session /", "language": "Python", "kind": "function", "signature": "(days: int = Query(7, ge=1, le=90), admin=Depends(_admin_required), db: Session = Depends(_get_db))"}, {"_type": "tag", "name": "summary", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/admin.py", "pattern": "/^def summary(admin=Depends(_admin_required), db: Session = Depends(_get_db)):$/", "language": "Python", "kind": "function", "signature": "(admin=Depends(_admin_required), db: Session = Depends(_get_db))"}, {"_type": "tag", "name": "top_books", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/admin.py", "pattern": "/^def top_books(limit: int = Query(5, ge=1, le=50), admin=Depends(_admin_required), db: Session = /", "language": "Python", "kind": "function", "signature": "(limit: int = Query(5, ge=1, le=50), admin=Depends(_admin_required), db: Session = Depends(_get_db))"}], "hash": "ad3ff73207e7ff3ddeef46b9ab0047ac", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/api/routers/admin.py", "fields": [{"name": "router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}]}