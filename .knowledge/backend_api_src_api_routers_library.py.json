{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints for managing a user's library of books, including listing, adding, retrieving, and removing library entries, using FastAPI, SQLAlchemy, and Pydantic.", "external_files": ["src/db/session.py", "src/models/book.py", "src/models/library.py", "src/models/user.py", "src/schemas/library.py", "src/services/auth_service.py", "src/utils/pagination.py"], "external_methods": ["get_db", "get_current_user", "PageMeta.build", "Paginated.model_validate", "LibraryRead.model_validate"], "published": ["router"], "classes": [{"name": "LibraryAddRequest", "description": "Pydantic model for the request payload to add a book to the library."}], "methods": [{"name": "_query_user_library_base", "description": "Builds a base SQLAlchemy select statement for a user's library with relationships preloaded."}, {"name": "list_library", "description": "Lists the library entries for the current user with optional search and pagination."}, {"name": "add_to_library", "description": "Adds a book to the current user's library, with checks for existence and duplicates."}, {"name": "get_library_entry", "description": "Retrieves a specific library entry by ID for the current user."}, {"name": "remove_from_library", "description": "Removes a library entry by ID for the current user."}], "calls": ["select", "selectinload", "func.count", "db.scalar", "db.execute", "db.get", "db.add", "db.commit", "db.refresh", "db.delete"], "search-terms": ["library management", "FastAPI library endpoints", "user book library", "SQLAlchemy library operations", "pagination", "add book to library", "retrieve library entry", "remove library entry"], "state": 2, "file_id": 42, "knowledge_revision": 113, "git_revision": "ca509fbf661e2730833baa85bfe12fd7fc01f886", "revision_history": [{"99": ""}, {"107": "ca509fbf661e2730833baa85bfe12fd7fc01f886"}, {"113": "ca509fbf661e2730833baa85bfe12fd7fc01f886"}], "ctags": [], "filename": "backend_api/src/api/routers/library.py", "format-version": 4, "code-base-name": "https://github.com/kavia-common/kindleplus-mobile-platform-40871-40880.git:kavia-main"}