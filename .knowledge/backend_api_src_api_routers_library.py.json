{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing a user's library, including listing, adding, retrieving, and deleting library entries. It uses FastAPI for the web framework and SQLAlchemy for database interactions, with data models and schemas related to books, libraries, and users.", "external_files": ["src/db/session.py", "src/models/book.py", "src/models/library.py", "src/models/user.py", "src/schemas/library.py", "src/services/auth_service.py", "src/utils/pagination.py"], "external_methods": ["get_db", "get_current_user", "PageMeta.build", "LibraryRead.model_validate"], "published": ["list_library", "add_to_library", "get_library_entry", "remove_from_library"], "classes": [{"name": "LibraryAddRequest", "description": "Request payload model for adding a book to the user's library."}], "methods": [{"name": "Select _query_user_library_base(user_id: str)", "description": "Builds a base SQLAlchemy Select statement to query libraries for a specific user, with related book and user data preloaded.", "scope": "", "scopeKind": ""}, {"name": "Paginated[LibraryRead] list_library( q: Optional[str] = Query(default=None, description=\"Search across book title and author\"), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Handles GET requests to list the current user's library with optional search, pagination, and sorting.", "scope": "", "scopeKind": ""}, {"name": "LibraryRead add_to_library( payload: LibraryAddRequest, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Handles POST requests to add a new book to the user's library, with checks for existing entries and book existence.", "scope": "", "scopeKind": ""}, {"name": "LibraryRead get_library_entry( entry_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Handles GET requests to retrieve a specific library entry by ID, verifying ownership.", "scope": "", "scopeKind": ""}, {"name": "Response remove_from_library( entry_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )", "description": "Handles DELETE requests to remove a library entry by ID, verifying ownership.", "scope": "", "scopeKind": ""}], "calls": ["selectinload(Library.book)", "selectinload(Library.user)", "select(Library)", "func.count(Library.id)", "or_(Book.title.ilike(like), Book.author.ilike(like))", "and_(Library.user_id == current_user.id, or_(Book.title.ilike(like), Book.author.ilike(like)))", "offset_limit(page, page_size)", "Paginated[LibraryRead]", "PageMeta.build", "LibraryRead.model_validate", "db.get", "db.scalar", "db.execute", "db.add", "db.commit", "db.refresh", "db.delete"], "search-terms": ["library endpoints", "FastAPI library router", "user library management", "library add book", "library list", "library retrieve", "library delete", "SQLAlchemy ORM", "pagination", "user-specific library"], "state": 2, "file_id": 42, "knowledge_revision": 107, "git_revision": "ca509fbf661e2730833baa85bfe12fd7fc01f886", "revision_history": [{"99": ""}, {"107": "ca509fbf661e2730833baa85bfe12fd7fc01f886"}], "ctags": [{"_type": "tag", "name": "LibraryAddRequest", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^class LibraryAddRequest(PydBaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PydBaseModel", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^from pydantic import BaseModel as PydBaseModel$/", "language": "Python", "kind": "unknown", "nameref": "unknown:BaseModel"}, {"_type": "tag", "name": "_query_user_library_base", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^def _query_user_library_base(user_id: str) -> Select:$/", "language": "Python", "typeref": "typename:Select", "kind": "function", "signature": "(user_id: str)"}, {"_type": "tag", "name": "add_to_library", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^def add_to_library($/", "language": "Python", "typeref": "typename:LibraryRead", "kind": "function", "signature": "( payload: LibraryAddRequest, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "book_id", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^    book_id: str = Field(..., description=\"Book ID to add to library\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LibraryAddRequest", "scopeKind": "class"}, {"_type": "tag", "name": "get_library_entry", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^def get_library_entry($/", "language": "Python", "typeref": "typename:LibraryRead", "kind": "function", "signature": "( entry_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "list_library", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^def list_library($/", "language": "Python", "typeref": "typename:Paginated[LibraryRead]", "kind": "function", "signature": "( q: Optional[str] = Query(default=None, description=\"Search across book title and author\"), page: int = Query(default=1, ge=1, description=\"Page number (1-based)\"), page_size: int = Query(default=20, ge=1, le=100, description=\"Items per page\"), db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "remove_from_library", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^def remove_from_library($/", "language": "Python", "typeref": "typename:Response", "kind": "function", "signature": "( entry_id: str, db: Session = Depends(get_db), current_user: User = Depends(get_current_user), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^router = APIRouter(prefix=\"\\/library\", tags=[\"Library\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "source", "path": "/home/kavia/workspace/code-generation/kindleplus-mobile-platform-40871-40880/backend_api/src/api/routers/library.py", "pattern": "/^    source: str = Field(default=\"manual\", description=\"Source of the library entry (e.g., purcha/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LibraryAddRequest", "scopeKind": "class"}], "hash": "be8d335b7f5f7230a74b45858790d4db", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/api/routers/library.py", "fields": [{"name": "str book_id", "scope": "LibraryAddRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/library\", tags=[\"Library\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "str source", "scope": "LibraryAddRequest", "scopeKind": "class", "description": "unavailable"}]}